<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GUZMÁN - Control de Producción</title>
    
    <meta property="og:title" content="GUZMÁN - Fashion & Production">
    <meta property="og:description" content="Gestión exclusiva de producción y venta de ropa. Joel Guzmán.">
    <meta property="og:image" content="https://ui-avatars.com/api/?name=Joel+Guzman&background=000000&color=ffffff&size=512&font-size=0.35&length=2">
    <meta property="og:url" content="https://joel-guzman.web.app">
    <meta property="og:type" content="website">

    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --primary: #1a1a1a;
            --accent: #d4af37; /* Dorado elegante */
            --bg: #f9f9f9;
            --white: #ffffff;
            --shadow: 0 4px 20px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg);
            margin: 0;
            color: var(--primary);
        }

        /* Header & Logo */
        header {
            background: var(--white);
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .brand-logo {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            letter-spacing: 0.3em;
            text-transform: uppercase;
            color: var(--primary);
            margin: 0;
            border-bottom: 2px solid var(--primary);
            display: inline-block;
            padding-bottom: 5px;
        }

        .brand-subtitle {
            font-size: 0.8rem;
            letter-spacing: 0.2em;
            margin-top: 10px;
            color: #666;
            text-transform: uppercase;
        }

        /* Contenedor Principal */
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        /* Tarjetas */
        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary);
        }

        h2 {
            font-family: 'Playfair Display', serif;
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        /* Formularios */
        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            font-size: 0.9rem;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            box-sizing: border-box;
            font-family: 'Lato', sans-serif;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Botones */
        .btn {
            background: var(--primary);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s;
            width: 100%;
            border-radius: 4px;
        }

        .btn:hover {
            background: #000;
            transform: translateY(-2px);
        }

        .btn-sell {
            background: var(--accent);
            padding: 5px 15px;
            font-size: 0.8rem;
            width: auto;
        }

        /* Lista de Inventario */
        .inventory-list {
            list-style: none;
            padding: 0;
        }

        .item-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }

        .item-info h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .item-details {
            font-size: 0.9rem;
            color: #666;
            margin-top: 4px;
        }

        .stock-badge {
            background: #eee;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.8rem;
        }

        .loading {
            text-align: center;
            color: #999;
            font-style: italic;
        }
        
        /* Notificaciones */
        #notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            display: none;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 2rem;
            color: #888;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>

    <header>
        <h1 class="brand-logo">GUZMÁN</h1>
        <div class="brand-subtitle">Clothing & Production Control</div>
    </header>

    <div class="container">
        <div class="card">
            <h2><i class="fas fa-plus-circle"></i> Nueva Producción</h2>
            <form id="addForm">
                <div class="form-group">
                    <label>Prenda</label>
                    <input type="text" id="itemName" placeholder="Ej. Camiseta Oversize Negra" required>
                </div>
                <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>
                        <label>Cantidad (Stock)</label>
                        <input type="number" id="itemQty" placeholder="0" required>
                    </div>
                    <div>
                        <label>Precio de Venta ($)</label>
                        <input type="number" id="itemPrice" placeholder="0.00" required>
                    </div>
                </div>
                <button type="submit" class="btn">Registrar en Inventario</button>
            </form>
        </div>

        <div class="card">
            <h2><i class="fas fa-layer-group"></i> Inventario Actual</h2>
            <div id="loadingMsg" class="loading">Cargando datos de Firebase...</div>
            <ul id="inventoryList" class="inventory-list">
                </ul>
        </div>
    </div>

    <div id="notification"></div>

    <footer>
        <p>Sistema desarrollado para Joel Guzmán &copy; 2025</p>
    </footer>

    <script type="module">
        // Importamos Firebase desde CDN para no necesitar node_modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js";

        // Configuración proporcionada
        const firebaseConfig = {
            apiKey: "AIzaSyBK7Q-fCS-aUlN-xzmWPfpacz6brPK8RSg",
            authDomain: "joel-guzman.firebaseapp.com",
            projectId: "joel-guzman",
            storageBucket: "joel-guzman.firebasestorage.app",
            messagingSenderId: "442355754536",
            appId: "1:442355754536:web:03144eb79ee8968b42771d",
            measurementId: "G-RTBBQMGE9S"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app); // Inicializamos la base de datos

        // Referencia al formulario y lista
        const addForm = document.getElementById('addForm');
        const inventoryList = document.getElementById('inventoryList');
        const loadingMsg = document.getElementById('loadingMsg');

        // FUNCIÓN 1: Agregar Producto a Firestore
        addForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('itemName').value;
            const qty = parseInt(document.getElementById('itemQty').value);
            const price = parseFloat(document.getElementById('itemPrice').value);

            try {
                await addDoc(collection(db, "ropa"), {
                    nombre: name,
                    stock: qty,
                    precio: price,
                    fecha: new Date()
                });
                
                showNotification(`"${name}" agregado exitosamente.`);
                addForm.reset();
            } catch (error) {
                console.error("Error al agregar: ", error);
                alert("Hubo un error al guardar. Revisa la consola.");
            }
        });

        // FUNCIÓN 2: Leer Inventario en Tiempo Real
        // Esto escucha cambios en la base de datos automáticamente
        const q = collection(db, "ropa");
        onSnapshot(q, (snapshot) => {
            inventoryList.innerHTML = ""; // Limpiar lista
            loadingMsg.style.display = "none";

            if (snapshot.empty) {
                inventoryList.innerHTML = "<p style='text-align:center'>No hay ropa en inventario aún.</p>";
            }

            snapshot.forEach((docSnap) => {
                const item = docSnap.data();
                const id = docSnap.id;

                const li = document.createElement('li');
                li.className = 'item-card';
                li.innerHTML = `
                    <div class="item-info">
                        <h3>${item.nombre}</h3>
                        <div class="item-details">
                            Precio: $${item.precio} | <span class="stock-badge">Stock: ${item.stock}</span>
                        </div>
                    </div>
                    <div>
                        ${item.stock > 0 
                            ? `<button class="btn btn-sell" onclick="venderItem('${id}', '${item.nombre}')">Vender 1</button>` 
                            : `<span style="color:red; font-size:0.8rem">AGOTADO</span>`
                        }
                    </div>
                `;
                inventoryList.appendChild(li);
            });
        });

        // FUNCIÓN 3: Registrar Venta (Disminuir Stock)
        // Hacemos esta función global para que el HTML pueda llamarla
        window.venderItem = async (id, nombre) => {
            if(confirm(`¿Confirmar venta de 1 unidad de "${nombre}"?`)) {
                const itemRef = doc(db, "ropa", id);
                
                try {
                    await updateDoc(itemRef, {
                        stock: increment(-1) // Resta 1 al stock atómicamente
                    });
                    showNotification("Venta registrada. Stock actualizado.");
                } catch (error) {
                    console.error("Error al vender: ", error);
                    alert("Error al procesar la venta.");
                }
            }
        };

        // Utilidad: Notificaciones
        function showNotification(msg) {
            const notif = document.getElementById('notification');
            notif.innerText = msg;
            notif.style.display = 'block';
            setTimeout(() => {
                notif.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
